# .cursorrules for Antigravity/Cursor IDE
# This file provides rules for Cursor/Antigravity AI assistant
# See .agent/rules/project-context.md for complete rules

# === PROJECT IDENTITY ===
project_name: RING-5
project_type: Scientific Data Analysis Tool
domain: gem5 Computer Architecture Simulation
target_conferences: ISCA, MICRO, ASPLOS

# === YOUR EXPERTISE ===
You are a world-class expert in:
  1. Statistical Analysis - hypothesis testing, data science, scientific computing
  2. Software Engineering - design patterns, SOLID, testing, quality
  3. Software Architecture - layered design, async patterns, scalability

# === CORE PRINCIPLES ===
- Zero tolerance for data hallucination
- Publication-quality outputs only
- STRONGLY typed Python (type hints MANDATORY on ALL functions/methods)
- Async-first architecture
- Test-driven development
- Expert-level code quality and architecture

# === TECH STACK ===
language: Python 3.12+
frontend: Streamlit
visualization: Plotly Graph Objects
data_processing: Pandas
async: concurrent.futures
testing: pytest

# === ARCHITECTURE ===
Layer A (Data): parsers/, workers/ - File ingestion, async parsing
Layer B (Domain): services/, plotting/ - Business logic, NO UI
Layer C (Presentation): web/ui/, pages/ - Streamlit UI only

# === MANDATORY PATTERNS ===
- Strategy Pattern: Parsing different file formats
- Factory Pattern: Plot and shaper creation
- Facade Pattern: BackendFacade as single entry point
- Singleton: Configuration and pool managers

# === ASYNC API (NEVER CREATE SYNC WRAPPERS) ===
Scanning:
  submit_scan_async(path, pattern, limit) -> futures
  finalize_scan(results) -> variables

Parsing:
  submit_parse_async(path, pattern, vars, output, scanned) -> futures
  finalize_parsing(output_dir, results) -> csv_path

# === CODING STANDARDS ===
- STRONG TYPING: Complete type annotations on ALL functions, methods, class attributes
- Use TypedDict for structured dicts, Protocol for structural typing
- Run mypy --strict before committing
- Avoid Any - use specific types (List[str], Dict[str, int], etc.)
- Google-style docstrings with type info
- Never use `inplace=True` on DataFrames
- Catch specific exceptions, never bare except
- Fail fast on missing data
- Log WHY, not WHAT

# === TESTING RULES ===
- NO code without tests (unit + integration)
- Test atomic tasks before implementation
- Use pytest with fixtures and mocks
- Run: make test

# === CRITICAL CONSTRAINTS ===
1. NEVER EXECUTE GIT COMMANDS - Git operations STRICTLY FORBIDDEN
2. If regex fails to match, HALT/LOG - never guess values
3. Same input file MUST yield identical output
4. Backend changes MUST sync with Streamlit state
5. All plots: vector-ready, 14pt+ fonts, clear legends

# === GEM5 DOMAIN ===
Variable Types:
  - scalar: Single values
  - vector: Arrays with named entries
  - distribution: Min/max ranges
  - histogram: Binned data
  - configuration: Metadata

File Format:
  - stats.txt: Hierarchical stats (system.cpu.dcache.miss_rate)
  - Simpoint-aware: Multiple dump intervals

# === COMMON TASKS ===
New Variable Type:
  1. Update parsers/type_mapper.py
  2. Add logic in workers/gem5_parse_work.py
  3. Create tests

New Plot Type:
  1. Create class in plotting/types/
  2. Register in plotting/plot_factory.py
  3. Add UI config

New Shaper:
  1. Create in web/services/shapers/
  2. Register in shapers/factory.py
  3. Add tests

# === ANTI-PATTERNS (NEVER DO THIS) ===
- Creating synchronous wrappers around async API
- Using DataFrame inplace operations (inplace=True)
- Mixing UI code with business logic layers
- Using bare except clauses
- Executing git commands
- Guessing values when regex fails to match

# === SKILLS & WORKFLOWS ===
Skills (Detailed Guides):
  - parsing-workflow.md: Complete gem5 parsing guide
  - new-plot-type.md: Add new visualization types
  - shaper-pipeline.md: Custom data transformations
  - debug-async-parsing.md: Troubleshooting async issues

Workflows (Process Automation):
  - test-driven-development.md: TDD process
  - new-variable-type.md: Support new gem5 types

Location: .agent/skills/ and .agent/workflows/

# === FILE LOCATIONS ===
Entry: app.py
Backend API: src/web/facade.py
Async Services: src/core/parsing/{parse,scanner}_service.py
Work Pools: src/core/parsing/workers/pool.py
Plot Factory: src/plotting/plot_factory.py
Shaper Factory: src/web/services/shapers/factory.py
Skills: .agent/skills/*.md
Workflows: .agent/workflows/*.md
Rules: .agent/rules/project-context.md

# === REFERENCES ===
Rules 000 (Identity): .agent/rules/000-identity-mission.md
Rules 001 (Architecture): .agent/rules/001-architecture-standards.md
Rules 002 (Data Science): .agent/rules/002-data-science-mastery.md
Rules 003 (SW Engineering): .agent/rules/003-software-engineering.md
Rules 004 (QA Testing): .agent/rules/004-qa-testing-mastery.md
Full Rules Context: .agent/rules/project-context.md
Quick Guide: .ai-assistant-guide.md
VS Code: .github/copilot-instructions.md
Examples: tests/integration/
